@startuml
title Use Case Diagram: ระบบจัดการห้องปฏิบัติการคอมพิวเตอร์ (CKLab)
left to right direction
skinparam monochrome true
skinparam shadow false
skinparam defaultFontName "Arial"

' เปลี่ยนรูปแบบ Actor จากตัวกางปลาเป็น Icon แบบทึบ (Awesome Style)
skinparam actorStyle awesome

actor "นักศึกษา/บุคลากร\n(Student/Staff)" as User
actor "บุคคลภายนอก\n(Guest)" as Guest
actor "ผู้ดูแลระบบ\n(Admin)" as Admin
actor "UBU API\n(System)" as API

rectangle "CKLab Management System" {
    
    ' Authentication Group
    usecase "เข้าสู่ระบบ / ยืนยันตัวตน" as Auth
    usecase "ลงทะเบียนผู้ใช้งานชั่วคราว" as Register
    
    ' User Actions
    usecase "ค้นหาเครื่อง (ตาม Software)" as Search
    usecase "จองเครื่อง (Booking)" as Book
    usecase "Check-in (เริ่มจับเวลา)" as CheckIn
    usecase "ขอต่อเวลา (Extend Time)" as Extend
    usecase "Logout & ประเมินความพึงพอใจ" as Checkout
    
    ' Admin Actions
    usecase "จัดการผังที่นั่ง (Seat Map)" as ManageSeat
    usecase "ตรวจสอบสถานะ Real-time" as Monitor
    usecase "Force Checkout / ปลดล็อคเครื่อง" as ForceOut
    usecase "ดูรายงานและสถิติ" as Report

}

' Relationships
User --> Auth
Guest --> Register
Register ..> Auth : <<include>>

' API Connection
Auth ..> API : <<verify>>

' Common User Flows
User --> Search
User --> Book
User --> CheckIn
User --> Extend

Guest --> CheckIn : (Walk-in)
Guest --> Extend

' Usage Flow Relationships (Structural Logic)
' การต่อเวลา เป็นส่วนขยายของการ Check-in (ทำหรือไม่ทำก็ได้)
CheckIn <.. Extend : <<extend>>
' การ Check-in (Session) ต้องจบด้วยการ Checkout เสมอ
CheckIn ..> Checkout : <<include>>

' Logic Note for Extend
note right of Extend
  <b>เงื่อนไขการต่อเวลา:</b>
  1. ทำได้เฉพาะเมื่อเครื่องว่าง (ไม่มีคิวจองต่อ)
  2. User/Guest กดทำรายการเองได้ทันที
  3. Admin มีสิทธิ์จัดการ/อนุมัติ (สิทธิ์เหนือกว่า)
end note

' Admin Flows
Admin --> Auth
Admin --> ManageSeat
Admin --> Monitor
Admin --> ForceOut
Admin --> Report
Admin --> Extend : (Force Extend)

@enduml